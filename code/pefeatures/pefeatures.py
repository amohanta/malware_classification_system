import argparse
import os

from utils.extractor import Extractor

def check_path(path):
    if os.path.isdir(path):
        return path
    else:
        raise argparse.ArgumentTypeError('Not a valid path')


def get_extractor():
    extractor = Extractor()
    return extractor


def get_file_features(file_name):
    extractor = get_extractor()
    return extractor.get_features(file_name)


def main():
    argument_parser = argparse.ArgumentParser()

    argument_parser.add_argument(
        '-p',
        '--path',
        required=True,
        help='Path to folder containing binaries')

    argument_parser.add_argument(
        '-d',
        '--debug',
        action='store_true',
        help='Print extracted information')

    arguments = argument_parser.parse_args()

    path = check_path(arguments.path)

    Extractor.setup_logging(arguments.debug)

    file_features = {}

    for file_name in os.listdir(path):
        abs_file_name = path + file_name
        if os.path.isfile(abs_file_name):
            get_file_features(abs_file_name)

if __name__ == '__main__':
    main()
