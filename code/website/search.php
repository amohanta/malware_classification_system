<?php
    /*
        SELECT SAM.FILETYPE_ID, SAM.FAMILY_ID, FAM.FAMILY_NAME, SAM.FILENAME, FT.FILETYPE, SAM.MD5, SAM.SHA256 
        FROM SAMPLE SAM 
        JOIN FILETYPE FT ON SAM.FILETYPE_ID = FT.FILETYPE_ID 
        JOIN FAMILY FAM ON SAM.FAMILY_ID = FAM.FAMILY_ID 
        WHERE SAM.MD5 = 'd8e8fca2dc0f896fd7cb4cb0031ba249';
    */

    //Connect to DB and create $db PDO object
    include("db.php");

    //Base query to perform
    $query = 'SELECT SAM.SAMPLE_ID, SAM.FILETYPE_ID, SAM.FAMILY_ID, FAM.FAMILY_NAME, SAM.FILENAME, FT.FILETYPE, SAM.MD5, SAM.SHA256 
              FROM SAMPLE SAM 
              JOIN FILETYPE FT ON SAM.FILETYPE_ID = FT.FILETYPE_ID 
              JOIN FAMILY FAM ON SAM.FAMILY_ID = FAM.FAMILY_ID WHERE';    

    //Results of the query on the database
    $results = null;

    //POST values we are expecting
    $sampleHash = null;
    $sampleFamily = null;
    $sampleFileType = null;
    $sampleDeliveryMethod = null;

    if(empty($_POST['sampleHash']) && $_POST['sampleFileType'] == 'Any' && $_POST['sampleFamily'] == 'Any' && $_POST['sampleDeliveryMethod'] == 'Any'){
        $query .= ' SAM.SAMPLE_ID IS NOT NULL';
    }
    else{
        if(isset($_POST['sampleFamily']) && !empty($_POST['sampleFamily']) && $_POST['sampleFamily'] != 'Any'){
            $sampleFamily = $_POST['sampleFamily'];
            $query .= ' FAM.FAMILY_ID = ?';
        }
        if(isset($_POST['sampleFileType']) && !empty($_POST['sampleFileType']) && $_POST['sampleFileType'] != 'Any'){
            $sampleFileType = $_POST['sampleFileType'];
            $query .= ' FT.FILETYPE = ? AND';
        }
        //if(isset($_POST['sampleDeliveryMethod']) && !empty($_POST['sampleDeliveryMethod'] && $_POST['sampleFamily'] != 'Any')){
        //    $sampleDeliveryMethod = $_POST['sampleDeliveryMethod'];
        //    $query .= ' DEL.'
        //}
        if(isset($_POST['sampleHash']) && !empty($_POST['sampleHash'])){
            $sampleHash = $_POST['sampleHash'];
        
            if(strlen($sampleHash) == 32){
                $query .= ' MD5 = ?';
            }
            elseif(strlen($sampleHash) == 64){
                $query .= ' SHA256 = ?';
            }
        }
    }

    echo $query;

    $statement = $pdo->prepare($query);
    $statement->execute[$sampleFamily];
    $results = $statement->fetch();

    echo $results;

    if($query != null){
        foreach($pdo->query($query) as $row){
            echo $row['FILENAME'];
            echo $row['FAMILY_NAME'];
            echo $row['FILETYPE'];
        }
    }

?>